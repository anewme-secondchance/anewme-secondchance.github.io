<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mindset | A New Me</title>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #eef2f7;
}

.app-header {
  display: flex;
  align-items: center;
  background: #1f3c88;
  color: white;
  padding: 15px;
}

.back-btn {
  background: white;
  color: #1f3c88;
  border: none;
  padding: 6px 14px;
  border-radius: 20px;
  cursor: pointer;
  margin-right: 15px;
}

.container {
  padding: 20px;
  max-width: 900px;
  margin: auto;
}

.card {
  background: white;
  padding: 20px;
  border-radius: 12px;
  margin-bottom: 20px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.08);
}

textarea {
  width: 100%;
  padding: 10px;
  border-radius: 8px;
  border: 1px solid #ccc;
  margin-top: 8px;
}

button {
  background: #1f3c88;
  color: white;
  border: none;
  padding: 8px 14px;
  border-radius: 6px;
  cursor: pointer;
  margin-top: 10px;
}

.sober-box {
  background: #f0f7ff;
  border-left: 5px solid #1f3c88;
  padding: 15px;
  border-radius: 10px;
}
</style>
</head>

<body>

<div class="app-header">
  <button onclick="goBack()" class="back-btn">‚Üê Back</button>
  <div>Mindset</div>
</div>

<div class="container">

<!-- JOURNALING -->
<div class="card">
<h3>What went well today?</h3>
<textarea id="r1"></textarea>
</div>

<div class="card">
<h3>What is one step forward I took?</h3>
<textarea id="r2"></textarea>
</div>

<div class="card">
<h3>What can I improve tomorrow?</h3>
<textarea id="r3"></textarea>
</div>

<!-- CONSISTENCY STREAK -->
<div class="card">
<h3>üî• Consistency Streak</h3>
<p>Days checked in: <strong id="streakCount">0</strong></p>
<button onclick="updateStreak()">Mark Today Complete</button>
</div>

<!-- ADVANCED SOBRIETY TRACKER -->
<div class="card sober-box">
<h3>üí™ Sobriety Tracker</h3>

<p>Current Streak: <strong id="soberCurrent">0</strong> days</p>
<p>Longest Streak: <strong id="soberLongest">0</strong> days</p>
<p>Total Sober Days: <strong id="soberTotal">0</strong></p>

<button onclick="markSoberDay()">I Stayed Sober Today</button>

<p id="soberMessage" style="margin-top:10px;color:green;"></p>
</div>

</div>

<script>

function goBack() {
  window.location.href = "index.html";
}

/* SAVE + LOAD */

function saveData(data) {
  localStorage.setItem("mindsetData", JSON.stringify(data));
}

function loadData() {
  return JSON.parse(localStorage.getItem("mindsetData")) || {
    r1: "",
    r2: "",
    r3: "",
    streak: 0,
    soberCurrent: 0,
    soberLongest: 0,
    soberTotal: 0,
    lastSoberDate: null
  };
}

/* INITIAL LOAD */

let data = loadData();

document.getElementById("r1").value = data.r1;
document.getElementById("r2").value = data.r2;
document.getElementById("r3").value = data.r3;
document.getElementById("streakCount").innerText = data.streak;
document.getElementById("soberCurrent").innerText = data.soberCurrent;
document.getElementById("soberLongest").innerText = data.soberLongest;
document.getElementById("soberTotal").innerText = data.soberTotal;

/* AUTO SAVE JOURNAL */

["r1","r2","r3"].forEach(id=>{
  document.getElementById(id).addEventListener("input", ()=>{
    data[id] = document.getElementById(id).value;
    saveData(data);
  });
});

/* CONSISTENCY */

function updateStreak() {
  data.streak++;
  document.getElementById("streakCount").innerText = data.streak;
  saveData(data);
}

/* SOBRIETY TRACKER */

function markSoberDay() {
  const today = new Date().toDateString();

  if (data.lastSoberDate === today) {
    document.getElementById("soberMessage").innerText =
      "You already marked today. Keep going.";
    return;
  }

  data.soberCurrent++;
  data.soberTotal++;
  data.lastSoberDate = today;

  if (data.soberCurrent > data.soberLongest) {
    data.soberLongest = data.soberCurrent;
  }

  document.getElementById("soberCurrent").innerText = data.soberCurrent;
  document.getElementById("soberLongest").innerText = data.soberLongest;
  document.getElementById("soberTotal").innerText = data.soberTotal;

  document.getElementById("soberMessage").innerText =
    "Day recorded. Keep building.";

  saveData(data);
}

</script>

</body>
</html>

<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Voice Assistant | A New Me</title>

<style>
body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #eef2f7;
    text-align: center;
}
.header {
    background: #1f3c88;
    color: white;
    padding: 20px;
}
.container {
    padding: 30px;
}
button {
    background: #1f3c88;
    color: white;
    border: none;
    padding: 14px 22px;
    border-radius: 8px;
    font-size: 16px;
    cursor: pointer;
    margin-top: 15px;
}
.status {
    margin-top: 20px;
    font-weight: bold;
}
.transcript {
    margin-top: 20px;
    color: #333;
    white-space: pre-line;
    text-align: left;
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
}
.notice {
    background: #fff3cd;
    color: #856404;
    padding: 12px;
    border-radius: 8px;
    margin-bottom: 20px;
    font-size: 14px;
}
</style>
</head>

<body>

<div class="header">
    <h2>ðŸ—£ Reentry Assistant</h2>
</div>

<div class="container">

<div id="deviceNotice" class="notice"></div>

<p>Talk to me. What do you need right now?</p>

<div class="notice">
<strong>How it works:</strong><br><br>
This assistant listens for keywords and guides you automatically.<br><br>
Try saying:<br>
â€¢ Job or Work<br>
â€¢ Housing or Rent<br>
â€¢ ID or License<br>
â€¢ Money or Budget<br>
â€¢ School or GED<br>
â€¢ Family
</div>

<button onclick="startListening()">ðŸŽ¤ Tap to Speak</button>

<div class="status" id="status"></div>
<div class="transcript" id="transcript"></div>

</div>

<script>

const statusDiv = document.getElementById("status");
const transcriptDiv = document.getElementById("transcript");
const deviceNotice = document.getElementById("deviceNotice");

const isIOS = /iphone|ipad|ipod/i.test(navigator.userAgent);

/* DEVICE NOTICE */
if (isIOS) {
    deviceNotice.innerHTML = `
        <strong>ðŸ“± iPhone Mode</strong><br><br>
        â€¢ Tap the microphone to speak<br>
        â€¢ Responses appear in text<br>
        â€¢ Voice playback limited by iOS
    `;
} else {
    deviceNotice.innerHTML = `
        <strong>ðŸ¤– Android / Desktop Mode</strong><br><br>
        â€¢ Tap the microphone to speak<br>
        â€¢ Responses play out loud
    `;
}

/* SPEAK FUNCTION */
function speak(text, redirectPage) {

    transcriptDiv.innerText += "\nAI: " + text;

    if (isIOS) {
        if (redirectPage) {
            setTimeout(() => {
                window.location.href = redirectPage;
            }, 1200);
        }
        return;
    }

    const speech = new SpeechSynthesisUtterance(text);
    speech.rate = 0.95;
    window.speechSynthesis.speak(speech);

    speech.onend = function() {
        if (redirectPage) {
            setTimeout(() => {
                window.location.href = redirectPage;
            }, 800);
        }
    };
}

/* LISTENING */
function startListening() {

    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

    if (!SpeechRecognition) {
        alert("Speech recognition not supported. Use Safari on iPhone or Chrome on Android.");
        return;
    }

    const recognition = new SpeechRecognition();
    recognition.lang = "en-US";
    recognition.interimResults = false;
    recognition.continuous = false;

    statusDiv.innerText = "Listening...";
    recognition.start();

    recognition.onresult = function(event) {
        const message = event.results[0][0].transcript.toLowerCase();
        transcriptDiv.innerText += "\nYou: " + message;
        statusDiv.innerText = "";
        setTimeout(() => routeUser(message), 400);
    };

    recognition.onerror = function() {
        statusDiv.innerText = "Speech failed. Try again.";
    };
}

/* ROUTING */
function routeUser(message) {

    if (message.includes("overwhelmed") || message.includes("stressed")) {
        speak("Take a breath. You are not alone. Do you need housing, a job, or ID help?");
        return;
    }

    if (message.includes("job") || message.includes("work")) {
        speak("Letâ€™s get you working again.", "employment.html");
        return;
    }

    if (message.includes("id") || message.includes("license")) {
        speak("Letâ€™s handle your ID.", "id-help.html");
        return;
    }

    if (message.includes("house") || message.includes("rent")) {
        speak("Opening housing options.", "housing.html");
        return;
    }

    if (message.includes("money") || message.includes("budget")) {
        speak("Letâ€™s get your money organized.", "money.html");
        return;
    }

    if (message.includes("school") || message.includes("ged")) {
        speak("Education opens doors.", "education.html");
        return;
    }

    if (message.includes("family")) {
        speak("Family matters. Taking you there now.", "family.html");
        return;
    }

    speak("Try saying job, housing, ID, money, education, or family.");
}

</script>

</body>
</html>

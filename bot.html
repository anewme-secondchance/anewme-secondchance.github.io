<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Voice Assistant | A New Me</title>

<style>
    body {
        margin: 0;
        font-family: Arial, sans-serif;
        background: #eef2f7;
        text-align: center;
    }
    .header {
        background: #1f3c88;
        color: white;
        padding: 20px;
    }
    .container {
        padding: 30px;
    }
    button {
        background: #1f3c88;
        color: white;
        border: none;
        padding: 14px 22px;
        border-radius: 8px;
        font-size: 16px;
        cursor: pointer;
        margin-top: 15px;
    }
    select {
        padding: 8px;
        margin-top: 10px;
        border-radius: 6px;
    }
    .status {
        margin-top: 20px;
        font-weight: bold;
    }
    .transcript {
        margin-top: 15px;
        color: #333;
        white-space: pre-line;
    }
</style>
</head>

<body>

<div class="header">
    <h2>ðŸ—£ Reentry Assistant</h2>
</div>

<div class="container">
    <p>Talk to me. What do you need right now?</p>

    <label>Select Voice:</label><br>
    <select id="voiceSelect">
        <option value="female">Female Voice</option>
        <option value="male">Male Voice</option>
    </select>

    <br>
    <button onclick="startListening()">ðŸŽ¤ Tap to Speak</button>

    <div class="status" id="status"></div>
    <div class="transcript" id="transcript"></div>
</div>

<script>
/* ---------------- ELEMENTS ---------------- */
const statusDiv = document.getElementById("status");
const transcriptDiv = document.getElementById("transcript");
const voiceSelect = document.getElementById("voiceSelect");

/* Detect iPhone */
const isIOS = /iphone|ipad|ipod/i.test(navigator.userAgent);

/* ---------------- SPEAK FUNCTION ---------------- */
function speak(text, redirectPage) {

    /* iPhone MODE â€” TEXT ONLY */
    if (isIOS) {
        transcriptDiv.innerText = text;

        if (redirectPage) {
            setTimeout(() => {
                window.location.href = redirectPage;
            }, 900);
        }
        return;
    }

    /* ANDROID MODE â€” SPEAK OUT LOUD */
    window.speechSynthesis.cancel();
    const speech = new SpeechSynthesisUtterance(text);
    const voices = window.speechSynthesis.getVoices();

    if (voiceSelect.value === "male") {
        const maleVoice = voices.find(v => v.name.toLowerCase().includes("david") || v.name.toLowerCase().includes("google"));
        if (maleVoice) speech.voice = maleVoice;
    } else {
        const femaleVoice = voices.find(v => 
            v.name.toLowerCase().includes("zira") || 
            v.name.toLowerCase().includes("samantha") || 
            v.name.toLowerCase().includes("google")
        );
        if (femaleVoice) speech.voice = femaleVoice;
    }

    speech.rate = 0.95;
    window.speechSynthesis.speak(speech);

    speech.onend = function() {
        if (redirectPage) {
            setTimeout(() => {
                window.location.href = redirectPage;
            }, 900);
        }
    };
}

/* ---------------- LISTENING ---------------- */
function startListening() {
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

    if (!SpeechRecognition) {
        alert("Speech recognition not supported. Use Safari on iPhone or Chrome on Android.");
        return;
    }

    const recognition = new SpeechRecognition();
    recognition.lang = "en-US";
    recognition.interimResults = false;
    recognition.continuous = false;

    statusDiv.innerText = "Listening...";
    recognition.start();

    recognition.onresult = function(event) {
        const message = event.results[0][0].transcript.toLowerCase();
        transcriptDiv.innerText = "You said: " + message;
        statusDiv.innerText = "";

        setTimeout(() => {
            routeUser(message);
        }, 400); // iPhone needs extra time
    };

    recognition.onerror = function() {
        statusDiv.innerText = "Speech failed.";
        alert("Speech failed. Try again.");
    };
}

/* ---------------- ROUTING ---------------- */
function routeUser(message) {

    /* EMOTIONAL SUPPORT */
    if (
        message.includes("scared") ||
        message.includes("overwhelmed") ||
        message.includes("lost") ||
        message.includes("stressed") ||
        message.includes("anxious") ||
        message.includes("panic") ||
        message.includes("worried")
    ) {
        speak("Hey. Slow down. Youâ€™re not alone. Youâ€™ve survived every hard day so far. Weâ€™ll take this one step at a time. What do you want to handle first?");
        return;
    }

    /* EMPLOYMENT */
    if (message.includes("job") || message.includes("work") || message.includes("employment")) {
        saveTopic("employment");
        speak("Good move. Letâ€™s get you working again.", "employment.html");
        return;
    }

    /* ID HELP */
    if (message.includes("id") || message.includes("identification") || message.includes("license")) {
        saveTopic("id");
        speak("ID is important. Letâ€™s get that handled.", "id-help.html");
        return;
    }

    /* HOUSING */
    if (message.includes("house") || message.includes("rent") || message.includes("shelter") || message.includes("place to stay")) {
        saveTopic("housing");
        speak("Housing comes first. Opening your options now.", "housing.html");
        return;
    }

    /* MONEY */
    if (message.includes("money") || message.includes("budget") || message.includes("bills") || message.includes("bank")) {
        saveTopic("money");
        speak("Letâ€™s get your money under control.", "money.html");
        return;
    }

    /* EDUCATION */
    if (message.includes("school") || message.includes("ged") || message.includes("education") || message.includes("classes")) {
        saveTopic("education");
        speak("Education opens doors. Letâ€™s get you started.", "education.html");
        return;
    }

    /* FAMILY */
    if (message.includes("family") || message.includes("kids") || message.includes("child") || message.includes("parenting")) {
        saveTopic("family");
        speak("Family matters. Letâ€™s work on that together.", "family.html");
        return;
    }

    /* MINDSET */
    if (message.includes("mindset") || message.includes("motivation") || message.includes("mental")) {
        saveTopic("mindset");
        speak("Your mind is your foundation. Letâ€™s strengthen it.", "mindset.html");
        return;
    }

    /* DEFAULT */
    speak("I didnâ€™t catch that. Try saying job, housing, ID, money, education, or family.");
}

/* ---------------- SAVE DATA ---------------- */
function saveTopic(topic) {
    localStorage.setItem("lastTopic", topic);

    let visits = parseInt(localStorage.getItem("visits")) || 0;
    visits += 1;
    localStorage.setItem("visits", visits);
}

/* ---------------- ON LOAD ---------------- */
/* No auto-start â€” homepage loads normally */
window.onload = function() {
    // intentionally empty
};
</script>

</body>
</html>
